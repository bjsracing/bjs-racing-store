---
// File: src/pages/checkout.astro
import MainLayout from '@/layouts/MainLayout.astro';
import CheckoutView from '@/components/CheckoutView.tsx';

const { session } = Astro.locals;
if (!session) {
  return Astro.redirect('/login?redirect=/checkout');
}

const midtransClientKey = import.meta.env.PUBLIC_MIDTRANS_CLIENT_KEY;
---

<MainLayout title="Checkout - BJS RACING STORE">
  
  {/* PERBAIKAN: Tempatkan skrip Midtrans di dalam slot head-scripts */}
  <script slot="head-scripts" is:inline src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key={midtransClientKey}></script>
  
  {/* Konten utama halaman akan otomatis masuk ke <slot /> di MainLayout */}
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8 text-center md:text-left">Checkout</h1>
    <CheckoutView client:load />
  </div>

</MainLayout>