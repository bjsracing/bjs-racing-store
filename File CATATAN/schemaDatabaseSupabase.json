-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.customer_addresses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL,
  label text,
  recipient_name text NOT NULL,
  recipient_phone text NOT NULL,
  full_address text NOT NULL,
  province_id text,
  city_id text,
  postal_code text,
  is_primary boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  destination text,
  destination_text text,
  CONSTRAINT customer_addresses_pkey PRIMARY KEY (id),
  CONSTRAINT customer_addresses_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.customers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nama_pelanggan text NOT NULL,
  telepon text,
  alamat text,
  catatan text,
  created_at timestamp with time zone DEFAULT now(),
  status text DEFAULT 'Aktif'::text,
  tipe_pelanggan text DEFAULT 'Eceran'::text,
  nama_pemilik text,
  auth_user_id uuid UNIQUE,
  CONSTRAINT customers_pkey PRIMARY KEY (id),
  CONSTRAINT customers_auth_user_id_fkey FOREIGN KEY (auth_user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.daftar_harga_mitra (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL,
  product_id uuid NOT NULL,
  harga_spesial numeric NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT daftar_harga_mitra_pkey PRIMARY KEY (id),
  CONSTRAINT daftar_harga_mitra_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT daftar_harga_mitra_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.expenses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tanggal timestamp with time zone NOT NULL,
  kategori_pengeluaran text,
  jumlah numeric NOT NULL,
  keterangan text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT expenses_pkey PRIMARY KEY (id)
);
CREATE TABLE public.held_transactions (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  notes text,
  customer_data jsonb,
  cart_data jsonb NOT NULL,
  CONSTRAINT held_transactions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.invoice_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invoice_id uuid NOT NULL,
  product_id uuid NOT NULL,
  kuantitas integer NOT NULL,
  harga_grosir_deal numeric NOT NULL,
  diskon_item_rp numeric DEFAULT 0,
  subtotal numeric NOT NULL,
  CONSTRAINT invoice_items_pkey PRIMARY KEY (id),
  CONSTRAINT invoice_items_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES public.invoices(id),
  CONSTRAINT invoice_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.invoices (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invoice_number text NOT NULL UNIQUE,
  sales_order_id uuid,
  customer_id uuid NOT NULL,
  tanggal_nota date NOT NULL DEFAULT CURRENT_DATE,
  tanggal_jatuh_tempo date,
  subtotal numeric NOT NULL,
  total_diskon numeric NOT NULL,
  total_akhir numeric NOT NULL,
  status_pembayaran text NOT NULL DEFAULT 'Belum Lunas'::text,
  termin_pembayaran text,
  bukti_pembayaran_url text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT invoices_pkey PRIMARY KEY (id),
  CONSTRAINT invoices_sales_order_id_fkey FOREIGN KEY (sales_order_id) REFERENCES public.sales_orders(id),
  CONSTRAINT invoices_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.permintaan_pelanggan (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nama_produk_diminta text NOT NULL,
  catatan text,
  jumlah_permintaan integer NOT NULL DEFAULT 1,
  status text NOT NULL DEFAULT 'Baru'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  kategori text,
  product_id uuid,
  CONSTRAINT permintaan_pelanggan_pkey PRIMARY KEY (id),
  CONSTRAINT permintaan_pelanggan_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_history_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid NOT NULL,
  field_changed text,
  old_value text,
  new_value text,
  change_type text NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT product_history_logs_pkey PRIMARY KEY (id),
  CONSTRAINT product_history_logs_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.product_lines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  brand_name text,
  line_name text,
  image_url text,
  CONSTRAINT product_lines_pkey PRIMARY KEY (id)
);
CREATE TABLE public.product_reviews (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  product_id uuid,
  customer_id uuid,
  author_name text,
  rating integer CHECK (rating >= 1 AND rating <= 5),
  comment text,
  CONSTRAINT product_reviews_pkey PRIMARY KEY (id),
  CONSTRAINT product_reviews_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id),
  CONSTRAINT product_reviews_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  kode text NOT NULL UNIQUE,
  nama text NOT NULL,
  kategori text,
  harga_beli numeric DEFAULT 0,
  harga_jual numeric DEFAULT 0,
  stok integer DEFAULT 0,
  stok_min integer DEFAULT 0,
  supplier text,
  created_at timestamp with time zone DEFAULT now(),
  status text DEFAULT 'Aktif'::text,
  merek text,
  updated_at timestamp with time zone DEFAULT now(),
  catatan text,
  supplier_id uuid,
  satuan_dasar text,
  satuan_pembelian text,
  nilai_konversi numeric NOT NULL DEFAULT 1,
  harga_grosir numeric DEFAULT 0,
  ukuran text,
  stok_dialokasikan integer DEFAULT 0,
  image_url text,
  color_swatch_url text,
  specifications jsonb,
  color_variant text,
  sku text,
  lini_produk text,
  harga_coret numeric,
  total_terjual integer DEFAULT 0,
  rating numeric DEFAULT 0,
  jumlah_ulasan integer DEFAULT 0,
  color_hex text,
  berat_gram integer NOT NULL DEFAULT 0,
  CONSTRAINT products_pkey PRIMARY KEY (id),
  CONSTRAINT products_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  updated_at timestamp with time zone,
  role text DEFAULT 'customer'::text,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id)
);
CREATE TABLE public.purchase_order_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  purchase_order_id uuid NOT NULL,
  product_id uuid NOT NULL,
  quantity_ordered integer NOT NULL,
  quantity_received integer,
  purchase_price numeric,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  catatan_item text,
  unit_ordered text,
  conversion_to_base numeric NOT NULL DEFAULT 1,
  CONSTRAINT purchase_order_items_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT purchase_order_items_purchase_order_id_fkey FOREIGN KEY (purchase_order_id) REFERENCES public.purchase_orders(id)
);
CREATE TABLE public.purchase_orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  po_number text NOT NULL UNIQUE,
  supplier_id uuid,
  order_date date NOT NULL DEFAULT CURRENT_DATE,
  status text NOT NULL DEFAULT 'Dipesan'::text,
  notes text,
  invoice_image_url text,
  total_amount numeric,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  shipping_cost numeric NOT NULL DEFAULT 0,
  discount_amount numeric NOT NULL DEFAULT 0,
  other_costs numeric NOT NULL DEFAULT 0,
  payment_status text NOT NULL DEFAULT 'Belum Dibayar'::text,
  due_date date,
  CONSTRAINT purchase_orders_pkey PRIMARY KEY (id),
  CONSTRAINT purchase_orders_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.sales_order_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sales_order_id uuid NOT NULL,
  product_id uuid NOT NULL,
  kuantitas integer NOT NULL,
  catatan_item text,
  satuan text,
  CONSTRAINT sales_order_items_pkey PRIMARY KEY (id),
  CONSTRAINT sales_order_items_sales_order_id_fkey FOREIGN KEY (sales_order_id) REFERENCES public.sales_orders(id),
  CONSTRAINT sales_order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.sales_orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  so_number text NOT NULL UNIQUE,
  customer_id uuid NOT NULL,
  tanggal_pesanan date NOT NULL DEFAULT CURRENT_DATE,
  status text NOT NULL DEFAULT 'Draft'::text,
  catatan_pesanan text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT sales_orders_pkey PRIMARY KEY (id),
  CONSTRAINT sales_orders_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.simulation_objects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  category text,
  name text,
  base_image_url text,
  model text,
  CONSTRAINT simulation_objects_pkey PRIMARY KEY (id)
);
CREATE TABLE public.simulation_variants (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  created_at timestamp with time zone DEFAULT now(),
  product_id uuid,
  simulation_object_id uuid,
  colored_image_url text,
  CONSTRAINT simulation_variants_pkey PRIMARY KEY (id),
  CONSTRAINT simulation_variants_simulation_object_id_fkey FOREIGN KEY (simulation_object_id) REFERENCES public.simulation_objects(id),
  CONSTRAINT simulation_variants_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.stock_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  product_id uuid,
  perubahan integer NOT NULL,
  keterangan text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT stock_logs_pkey PRIMARY KEY (id),
  CONSTRAINT stock_logs_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.suppliers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  nama_supplier text NOT NULL UNIQUE,
  kontak_person text,
  telepon text,
  alamat text,
  catatan text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT suppliers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  total numeric NOT NULL,
  diskon numeric DEFAULT 0,
  total_akhir numeric NOT NULL,
  bayar numeric NOT NULL,
  kembalian numeric NOT NULL,
  items jsonb,
  created_at timestamp with time zone DEFAULT now(),
  total_laba numeric DEFAULT 0,
  customer_id uuid,
  status_pembayaran text DEFAULT 'Lunas'::text,
  sisa_hutang numeric DEFAULT 0,
  invoice_number text,
  CONSTRAINT transactions_pkey PRIMARY KEY (id),
  CONSTRAINT transactions_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);